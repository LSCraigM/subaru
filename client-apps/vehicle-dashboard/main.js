let text = 
`[{
    "vehicle": {
      "image": "/subaru/images/forester_image.jpg",
      "image_name": "subaru-forester",
      "vin": "JF2SJADC8GH451027",
      "model": "Forester",
      "trim": "Premium + MR",
      "year": "2016",
      "engine_type": "2.5L Naturally Aspirated U5",
      "engine_number": "51027",
      "final_inspection_date": "2015/08/05",
      "sale_date": "2015/10/18",
      "transmission": "MT"
    },
    "documentation": {
      "service_bulletin_url": "",
      "service_manual_url": "",
      "owner_manual": "",
      "installation_guides": ""
    },
    "dtc": [
      {
        "dtcDateTime": "2021/03/24 13:21",
        "mileage": "98,057",
        "dtcName": "02 Heater Control",
        "dtcNumber": "P0030",
        "dtcTargetUnit": "E/G CU Circuit Bank 1 Sensor 1"
      },
      {
        "dtcDateTime": "2021/03/24 13:21",
        "mileage": "98,057",
        "dtcName": "02 Heater Control",
        "dtcNumber": " P0031",
        "dtcTargetUnit": "E/G CU Circuit Bank 1 Sensor 1"
      },
      {
        "dtcDateTime": "2021/03/24 13:21",
        "mileage": "98,057",
        "dtcName": "02 Heater Control",
        "dtcNumber": "P0032",
        "dtcTargetUnit": "E/G CU Circuit Bank 1 Sensor 1"
      }
    ],
    "recall": [
      {
        "service_campaign": "WUT05",
        "type": "Customer Satisfaction",
        "name": "Forester Rear Coil Springs",
        "bulletin_url": "https://www.subaru.com/recalls.html?vin=JF2SJADC8GH451027",
        "notification_date": "2022/01/10",
        "resolved_date": ""
      },
      {
        "service_campaign": "WUM98",
        "type": "Safety",
        "name": "Forester Passenger-side Front Airbag ODS",
        "bulletin_url": "https://www.subaru.com/recalls.html?vin=JF2SJADC8GH451027",
        "notification_date": "2020/06/05",
        "resolved_date": "2020/07/04"
      },
      {
        "service_campaign": "WUE90",
        "type": "Safety",
        "name": "Brake Lamp Switch Replacement",
        "bulletin_url": "https://www.subaru.com/recalls.html?vin=JF2SJADC8GH451027",
        "notification_date": "2019/08/16",
        "resolved_date": "2020/07/04"
      },
      {
        "service_campaign": "WQZ61",
        "type": "Other",
        "name": "Telematics DCM ID Check & Reprogramming",
        "bulletin_url": "https://www.subaru.com/recalls.html?vin=JF2SJADC8GH451027",
        "notification_date": "2018/01/11",
        "resolved_date": "2018/04/21"
      }
    ],
    "ecu": [
      {
        "name": "Brake Control",
        "description": "Improvement of climbing performance",
        "current_software_version": "22765 00001",
        "release_date_current": "2016/01/22",
        "new_software_version": "22765 00002",
        "release_date_new": "2022/04/30",
        "reprogramming_date": "2022/06/21"
      }
    ],
		"schedule": [
      {
        "creationDate": "2022/06/05",
        "workFlow": "Standard A Service",
        "deadLine": "2022/06/30",
        "resolvedDate": ""
      },
			{
        "creationDate": "2022/04/21",
        "workFlow": "Ignition System Inspection",
        "deadLine": "2022/04/25",
        "resolvedDate": "2022/04/22"
      },
			{
        "creationDate": "2021/12/15",
        "workFlow": "Standard B Service",
        "deadLine": "2021/12/31",
        "resolvedDate": "2021/12/26"
      }
    ],
    "service_procedures": [
      {
        "title_jp": "シフトロック回路点検",
        "title_en": "Shift-Lock Circuit Inspection",
        "description": "-",
        "flow_link": "9bf61d4c-c562-4efd-b57f-15810dcfc55a",
        "hmt_link": "30563471-937c-4137-ac07-5499d8db0d69"
      },
      {
        "title_jp": "12ヶ月点検",
        "title_en": "12-Month Inspection",
        "description": "-",
        "flow_link": "e5c7a8b2-b68f-4e22-a3d6-0b3af3466130",
        "hmt_link": "cb00d83a-a69b-4985-bf99-2854d51cb7b5"
      },
      {
        "title_jp": "パワーステアリングギヤボックス取付け",
        "title_en": "Power Steering Gearbox Mounting",
        "description": "Impreza / XV, 区分D, Pub No. G1377JJ",
        "flow_link": "45e94852-a978-497b-8318-fa8b236820d2",
        "hmt_link": "45e94852-a978-497b-8318-fa8b236820d2"
      },
      {
        "title_jp": "パワーステアリングギアボックス取外し",
        "title_en": "Power Steering Gearbox Removal",
        "description": "IMPREZA XV, 区分D, Pub No. G1377JJ",
        "flow_link": "2dd444d4-c108-4db8-825f-1b1a0118426e",
        "hmt_link": "c2f43cf8-63d6-44af-b876-9b2f0235d6d6"
      },
      {
        "title_jp": "エンジン単体チェーンカバー取付け",
        "title_en": "Engine single chain cover mounting",
        "description": "Impreza 2.0L, 区分：D, Pub No. G1377JJ",
        "flow_link": "988ad7d3-aea0-46d2-b314-cc03e05f9fb1",
        "hmt_link": "532202fa-6ca7-40d0-a6a9-706617df8a09"
      },
      {
        "title_jp": "エンジン単体チェーンカバー取外し",
        "title_en": "Removal of engine chain cover",
        "description": "Impreza 2.0L, 区分D, Pub No. G1377JJ",
        "flow_link": "e329bd3d-0f20-44f3-8123-a02be7067705",
        "hmt_link": "eaa40587-ad59-4933-8404-e27e2fcd053d"
      }
    ]
  }
]`;

const obj = JSON.parse(text);

text = 
`[{
	"language": "en-us",
	"title": "Vehicle Dashboard",
	"search": "Search",
	"model_yr": "Model Year",
	"model_type": "Model Type",
	"trim": "Trim",
	"vehicle_info": "Vehicle Info",
	"vehicle_vin": "VIN:",
	"vehicle_engine_type": "ENGINE TYPE:",
	"vehicle_model": "MODEL:",
	"vehicle_engine_no": "ENGINE NO:",
	"vehicle_trim": "TRIM:",
	"vehicle_transmission": "TRANSMISSION TYPE:",
	"vehicle_year": "YEAR:",
	"serviceBulletins": "Service Bulletins",
	"serviceManuals": "Service Manuals",
	"ownersManual": "Owner's Manual",
	"installationGuides": "Installation Guides",
	"techTips": "Tech Tips",
	"serviceHistory": "Service History",
	"dtc": "DTC",
	"dtc_date": "Date",
	"dtc_name": "Name",
	"dtc_number": "Number",
	"dtc_target_unit": "Target Unit",
	"dtc_mileage": "Mileage",
	"recall": "Recalls",
	"recall_service_campaign": "Service Campaign",
	"recall_type": "Type",
	"recall_name": "Name",
	"recall_bulletin": "Bulletin",
	"recall_notification_date": "Notification Date",
	"recall_resolved_date": "Resolved Date",
	"ecu": "ECU",
	"ecu_name": "Name",
	"ecu_description": "Description",
	"ecu_current_software_ver": "Current Software Version",
	"ecu_current_rel_date": "Release Date (Current)",
	"ecu_new_software_ver": "New Software Version",
	"ecu_new_rel_date": "Release Date (New)",
	"ecu_reprogramming_date": "Reprogramming Date",
	"schedule_title": "Your Schedule",
	"schedule_creation_date": "Creation date",
	"schedule_workflow": "Workflow to Complete",
	"schedule_deadline": "Deadline",
	"schedule_resolved_date": "Resolved Date",
	"schedule_reassignment": "Request Reassignment",
	"sp": "Service Procedures",
	"sp_title": "Title",
	"sp_description": "Description",
	"no_vin": "VIN not found"
}, {
	"language": "ja-jp",
	"title": "車両ダッシュボード",
	"search": "検索",
	"model_yr": "車両年式",
	"model_type": "車種",
	"trim": "トリム",
	"vehicle_info": "車両情報",
	"vehicle_vin": "VIN:",
	"vehicle_engine_type": "エンジンタイプ:",
	"vehicle_model": "車種:",
	"vehicle_engine_no": "エンジンNO:",
	"vehicle_trim": "トリム:",
	"vehicle_transmission": "トランスミッション:",
	"vehicle_year": "年式:",
	"serviceBulletins": "サービスニュース",
	"serviceManuals": "サービスマニュアル",
	"ownersManual": "オーナーマニュアル",
	"installationGuides": "セットアップガイド",
	"techTips": "修理ヒント",
	"serviceHistory": "修理履歴",
	"dtc": "DTC",
	"dtc_date": "日付",
	"dtc_name": "名称",
	"dtc_number": "参照番号",
	"dtc_target_unit": "対象システム",
	"dtc_mileage": "マイレージ",
	"recall": "リコール",
	"recall_service_campaign": "リコール届出",
	"recall_type": "タイプ",
	"recall_name": "名称",
	"recall_bulletin": "届出リンク",
	"recall_notification_date": "発行日付",
	"recall_resolved_date": "解決日付",
	"ecu": "リプロ",
	"ecu_name": "名称",
	"ecu_description": "説明",
	"ecu_current_software_ver": "現在ソフトバージョン",
	"ecu_current_rel_date": "リリース日付 (現在バージョン)",
	"ecu_new_software_ver": "新ソフトバージョン",
	"ecu_new_rel_date": "リリース日付 (新バージョン)",
	"ecu_reprogramming_date": "リプロスケジュール",
	"schedule_title": "自分のスケジュール",
	"schedule_creation_date": "作成日付",
	"schedule_workflow": "作業内容",
	"schedule_deadline": "締め切り",
	"schedule_resolved_date": "解決日付",
	"schedule_reassignment": "転送リクエスト",
	"sp": "デジタル作業手順リンク",
	"sp_title": "名称",
	"sp_description": "説明",
	"no_vin": "VINが見つかりませんでした"
}]`;

const content = JSON.parse(text);

const urlParams = new URLSearchParams(window.location.search);
const languaugeSelected = urlParams.get('language');

loadHtml();

var lang;
function loadHtml(){
  var e = document.getElementById("language");
  var language = e.options[e.selectedIndex].value;
  if (languaugeSelected != null && languaugeSelected != undefined) {
    language = languaugeSelected;
    e.value = languaugeSelected;
  } 
  
  for (var i in content) {
    if (content[i].language == language) {
      lang = content[i];
    }
  }
  document.getElementById("pageTitle").innerText = lang.title;
  document.getElementById("vinSearch").innerText = lang.search;
  document.getElementById("modelYear").innerText = lang.model_yr;
  document.getElementById("modelName").innerText = lang.model_type;
  document.getElementById("modelTrim").innerText = lang.trim;
  document.getElementById("modelSearch").innerText = lang.search;
  document.getElementById("vehicleInfoTitle").innerText = lang.vehicle_info;
  document.getElementById("serviceBulletins").innerText = lang.serviceBulletins;
  document.getElementById("serviceManuals").innerText = lang.serviceManuals;
  document.getElementById("ownersManual").innerText = lang.ownersManual;
  document.getElementById("installationGuides").innerText = lang.installationGuides;
  document.getElementById("techTips").innerText = lang.techTips;
  document.getElementById("serviceHistory").innerText = lang.serviceHistory;
  document.getElementById("dtcTitle").innerText = lang.dtc;
  document.getElementById("dtcDate").innerText = lang.dtc_date;
  document.getElementById("dtcName").innerText = lang.dtc_name;
  document.getElementById("dtcNumber").innerText = lang.dtc_number;
  document.getElementById("dtcTargetUnit").innerText = lang.dtc_target_unit;
  document.getElementById("dtcMileage").innerText = lang.dtc_mileage;
  document.getElementById("recalls").innerText = lang.recall;
  document.getElementById("recallsServiceCampaign").innerText = lang.recall_service_campaign;
  document.getElementById("recallType").innerText = lang.recall_type;
  document.getElementById("recallsName").innerText = lang.recall_name;
  document.getElementById("recallsBulletin").innerText = lang.recall_bulletin;
  document.getElementById("recallsNotificationDate").innerText = lang.recall_notification_date;
  document.getElementById("recallsResolvedDate").innerText = lang.recall_resolved_date;
  document.getElementById("ecu").innerText = lang.ecu;
  document.getElementById("ecuName").innerText = lang.ecu_name;
  document.getElementById("ecuDescription").innerText = lang.ecu_description;
  document.getElementById("ecuCurrentSoftwareVersion").innerText = lang.ecu_current_software_ver;
  document.getElementById("ecuCurrentReleaseDate").innerText = lang.ecu_current_rel_date;
  document.getElementById("ecuNewSoftwareVersion").innerText = lang.ecu_new_software_ver;
  document.getElementById("ecuNewReleaseDate").innerText = lang.ecu_new_rel_date;
  document.getElementById("ecuReprogrammingDate").innerText = lang.ecu_reprogramming_date;
	document.getElementById("schedule").innerText = lang.schedule_title;
	document.getElementById("scheduleCreationDate").innerText = lang.schedule_creation_date;
	document.getElementById("scheduleWorkflow").innerText = lang.schedule_workflow;
	document.getElementById("scheduleDeadline").innerText = lang.schedule_deadline;
	document.getElementById("scheduleResolvedDate").innerText = lang.schedule_resolved_date;
	document.getElementById("scheduleReassignment").innerText = lang.schedule_reassignment;
  document.getElementById("serviceProcedures").innerText = lang.sp;
  document.getElementById("serviceProceduresName").innerText = lang.sp_title;
  document.getElementById("serviceProceduresDescription").innerText = lang.sp_description;
  for (var i in document.getElementsByClassName("no-vin-specified")) {
    document.getElementsByClassName("no-vin-specified")[i].innerText = lang.no_vin;
  }
}

function deviceType() {
  const ua = navigator.userAgent;
  if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) {
      return "tablet";
  }
  else if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(ua)) {
      return "mobile";
  }
  return "desktop";
};

document.getElementById("vinSearch").addEventListener('click', setQueryStr);
document.getElementById("language").addEventListener('change', setQueryStrOption);

function setQueryStr() {
    var vinNumber = document.getElementById("vinNumberHdn").value = document.getElementById("vin").value;
    var url = new URL(window.location.href);
    url.searchParams.set('vin', vinNumber);
    window.location.replace(url.toString());
}

function setQueryStrOption() {
  var e = document.getElementById("language");
  var language = e.options[e.selectedIndex].value;
  document.getElementById("languageHdn").value = language;
  var url = new URL(window.location.href);
  url.searchParams.set('language', language);
  window.location.replace(url.toString());
}

const vinNumber = urlParams.get('vin');
document.getElementById("vin").value = vinNumber;
var noMatch = true;
if (vinNumber != '' && vinNumber != null) {
    document.getElementById("no-vin-specified").innerText = '';
    for (var i in obj) {
        if (obj[i].vehicle.vin == vinNumber) {
            noMatch = false;
						// Vehicle Info
            if (languaugeSelected == 'en-us') {
              document.getElementById("vinNumber").innerHTML = '<p class="font-weight-bold">VIN:</p><p>' + obj[i].vehicle.vin + '</p>';
              document.getElementById("engineType").innerHTML = '<p class="font-weight-bold">ENGINE TYPE:</p><p>' + obj[i].vehicle.engine_type + '</p>';
              document.getElementById("model").innerHTML = '<p class="font-weight-bold">MODEL:</p><p>' + obj[i].vehicle.model + '</p>';
              document.getElementById("engineNo").innerHTML = '<p class="font-weight-bold">ENGINE NO:</p><p>' + obj[i].vehicle.engine_number + '</p>';
              document.getElementById("trim").innerHTML = '<p class="font-weight-bold">TRIM:</p><p>' + obj[i].vehicle.trim + '</p>';
              document.getElementById("transmission").innerHTML = '<p class="font-weight-bold">TRANSMISSION:</p><p>' + obj[i].vehicle.transmission + '</p>';
              document.getElementById("year").innerHTML = '<p class="font-weight-bold">YEAR:</p><p>' + obj[i].vehicle.year + '</p>';
              document.getElementById("img").innerHTML = '<img src="'+obj[i].vehicle.image+'" class="img-fluid" alt="'+obj[i].vehicle.image_name+'"></img>';
            } else {
              document.getElementById("vinNumber").innerHTML = '<p class="font-weight-bold">VIN:</p><p>' + obj[i].vehicle.vin + '</p>';
              document.getElementById("engineType").innerHTML = '<p class="font-weight-bold">エンジンタイプ:</p><p>' + obj[i].vehicle.engine_type + '</p>';
              document.getElementById("model").innerHTML = '<p class="font-weight-bold">車種:</p><p>' + obj[i].vehicle.model + '</p>';
              document.getElementById("engineNo").innerHTML = '<p class="font-weight-bold">エンジンNO:</p><p>' + obj[i].vehicle.engine_number + '</p>';
              document.getElementById("trim").innerHTML = '<p class="font-weight-bold">トリム:</p><p>' + obj[i].vehicle.trim + '</p>';
              document.getElementById("transmission").innerHTML = '<p class="font-weight-bold">トランスミッション:</p><p>' + obj[i].vehicle.transmission + '</p>';
              document.getElementById("year").innerHTML = '<p class="font-weight-bold">年式:</p><p>' + obj[i].vehicle.year + '</p>';
              document.getElementById("img").innerHTML = '<img src="'+obj[i].vehicle.image+'" class="img-fluid" alt="'+obj[i].vehicle.image_name+'"></img>';
            }
            // Technical Documentation

            // DTC
            let dtcRows = '';
            for (var ii in obj[i].dtc) {
              var rowStatus = '';
              rowStatus = '<i class="fa fa-square fa-2 text-success" aria-hidden="true"></i>'; 
              var row = 
                '<tr><td>' 
                + rowStatus
                + '</td><td>' 
                + obj[i].dtc[ii].dtcDateTime 
                + '</td><td>' 
                + obj[i].dtc[ii].dtcName 
                + '</td><td>' 
                + obj[i].dtc[ii].dtcNumber 
                + '</td><td>' 
                + obj[i].dtc[ii].dtcTargetUnit 
                + '</td><td>' 
                + obj[i].dtc[ii].mileage 
                + '</td></tr>';
                dtcRows = dtcRows + row;
            }
            document.getElementById("tblDtc").innerHTML = dtcRows;

						// Schedule
            let scheduleRows = '';
            for (var im in obj[i].schedule) {
              var rowStatus = '';
              rowStatus = '<i class="fa fa-square fa-2 text-success" aria-hidden="true"></i>'; 
              if (obj[i].schedule[im].resolvedDate == '') {
                rowStatus = '<i class="fa fa-square fa-2 text-danger" aria-hidden="true"></i>';  
              }
              var row = 
                '<tr><td>' 
                + rowStatus
                + '</td><td>' 
                + obj[i].schedule[im].creationDate 
                + '</td><td>' 
                + obj[i].schedule[im].workFlow 
                + '</td><td>' 
                + obj[i].schedule[im].deadLine 
                + '</td><td>'
								+ obj[i].schedule[im].resolvedDate 
								+ '</td><td>'
                + '<button class="btn btn-outline-success disabled" type="submit">Reassign</button>' 
                + '</td></tr>';
                scheduleRows = scheduleRows + row;
            }
            document.getElementById("tblSchedule").innerHTML = scheduleRows;

            // Recalls
            let recallRows = '';
            for (var ij in obj[i].recall) {
              var rowStatus = '';
              rowStatus = '<i class="fa fa-square fa-2 text-success" aria-hidden="true"></i>'; 
              if (obj[i].recall[ij].resolved_date == '') {
                rowStatus = '<i class="fa fa-square fa-2 text-danger" aria-hidden="true"></i>';  
              }
              var row = 
                '<tr><td>' 
                + rowStatus
                + '</td><td>' 
                + obj[i].recall[ij].service_campaign 
                + '</td><td>' 
                + obj[i].recall[ij].type 
                + '</td><td>' 
                + obj[i].recall[ij].name 
                + '</td><td><a target="_blank" href=' 
                + obj[i].recall[ij].bulletin_url 
                + '>' + obj[i].recall[ij].bulletin_url + '</a></td><td>' 
                + obj[i].recall[ij].notification_date 
                + '</td><td>'
                + obj[i].recall[ij].resolved_date 
                + '</td></tr>'
                recallRows = recallRows + row;
            }
            document.getElementById("tblRecall").innerHTML = recallRows;

            // ECU
            let ecuRows = '';
            for (var ik in obj[i].ecu) {
              var rowStatus = '';
              rowStatus = '<i class="fa fa-square fa-2 text-success" aria-hidden="true"></i>'; 
              var row = 
                '<tr><td>' 
                + rowStatus
                + '</td><td>' 
                + obj[i].ecu[ik].name 
                + '</td><td>' 
                + obj[i].ecu[ik].description 
                + '</td><td>' 
                + obj[i].ecu[ik].current_software_version 
                + '</td><td>'
                + obj[i].ecu[ik].release_date_current 
                + '</td><td>' 
                + obj[i].ecu[ik].new_software_version
                + '</td><td>'
                + obj[i].ecu[ik].release_date_new  
                + '</td><td>'
                + obj[i].ecu[ik].reprogramming_date
                + '</td></tr>'
                ecuRows = ecuRows + row;
            }
            document.getElementById("tblECU").innerHTML = ecuRows;

            // Service Procedures
            let spRows = '';
            for (var ij in obj[i].service_procedures) {
              var flowLink = '';
              if (deviceType() == 'tablet') {
                flowLink = 'workfloplus://launchworkflow?workflowId=' + obj[i].service_procedures[ij].hmt_link;
              } else if (deviceType() == 'mobile') {
                flowLink = 'workfloplus://launchworkflow?workflowId=' + obj[i].service_procedures[ij].flow_link;
              } else { // deviceType is desktop
                flowLink = 'https://flow.onsight.librestream.com/new/' + obj[i].service_procedures[ij].flow_link;
              }

              var title = ((languaugeSelected == 'en-us') ? obj[i].service_procedures[ij].title_en : (languaugeSelected == 'ja-jp') ? obj[i].service_procedures[ij].title_jp : obj[i].service_procedures[ij].title_jp);
              var row = 
              '<tr><td><a target="_blank" href="'+flowLink+'">' 
              + title + '</a></td><td>' 
              + obj[i].service_procedures[ij].description + '</td></tr>'
              spRows = spRows + row;
            }
            document.getElementById("tblSP").innerHTML = spRows;
        }
    }
} 

if (noMatch) {
	document.getElementById("no-vin-specified").innerText = lang.no_vin;
}
